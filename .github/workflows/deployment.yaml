name: Deploy Process

on:
    push:
        branches:
            - main
jobs:
    deploy:
        name: 🔧 Deployment on docker
        runs-on: kaotice
        steps:
            - name: Checkout code
              uses: actions/checkout@v4

            - name: 🧹 Limpiar y copiar a /opt/services/api
              run: |
                  echo "${{ secrets.SUDO_PASSWORD }}" | sudo -S mkdir -p /opt/services/klickum-process
                  rm -rf /opt/services/klickum-process/*
                  cp -r . /opt/services/klickum-process
                  cd .. 
                  ll
                  cp .env /opt/services/klickum-process/.env
            - name: 🚀 Deploy with docker-compose
              run: |
                  echo "⏬ Apagando contenedores actuales..."
                  docker compose down
                  echo "🚀 Levantando servicios actualizados..."
                  docker compose up -d --build
