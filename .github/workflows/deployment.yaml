name: Deploy Process

on:
    push:
        branches:
            - main
jobs:
    deploy:
        name: 🔧 Deployment on docker
        runs-on: kaotice
        steps:
            - name: Checkout code
              uses: actions/checkout@v4

            - name: 🧹 Limpiar y copiar a /opt/services/api
              run: |
                  sudo mkdir -p /opt/services/klickum-process
                  sudo rm -rf /opt/services/klickum-process/*
                  sudo cp -r . /opt/services/klickum-process
                  sudo cd .. 
                  sudo cp .env /opt/services/klickum-process/.env
            - name: 🚀 Deploy with docker-compose
              run: |
                  echo "⏬ Apagando contenedores actuales..."
                  sudo docker compose down
                  echo "🚀 Levantando servicios actualizados..."
                  sudo docker compose up -d --build
