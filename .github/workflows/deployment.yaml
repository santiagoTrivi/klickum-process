name: Deploy Process

on:
    push:
        branches:
            - main
jobs:
    deploy:
        name: üîß Deployment on docker
        runs-on: kaotice
        steps:
            - name: Checkout code
              uses: actions/checkout@v4

            - name: üßπ Limpiar y copiar a /opt/services/api
              run: |
                  echo "${{ secrets.SUDO_PASSWORD }}" | sudo -S mkdir -p /opt/services/klickum-process
                  echo "${{ secrets.SUDO_PASSWORD }}" | rm -rf /opt/services/klickum-process/*
                  echo "${{ secrets.SUDO_PASSWORD }}" | cp -r . /opt/services/klickum-process
                  cd .. 
                  ll
                  echo "${{ secrets.SUDO_PASSWORD }}" | cp .env /opt/services/klickum-process/.env
            - name: üöÄ Deploy with docker-compose
              run: |
                  echo "‚è¨ Apagando contenedores actuales..."
                  echo "${{ secrets.SUDO_PASSWORD }}" | docker compose down
                  echo "üöÄ Levantando servicios actualizados..."
                  echo "${{ secrets.SUDO_PASSWORD }}" | docker compose up -d --build
